# iOSバス時刻表アプリ 仕様書

- **バージョン:** 0.6 (最終版)
- **作成日:** 2025/08/21

---

## 1. アプリの目的

家族が日常的に利用する複数のバス路線の時刻表情報とリアルタイム接近情報を集約し、一つのアプリで簡単に確認できるようにする。手動での情報確認の手間を省き、乗り遅れを防ぐことを目的とする。

---

## 2. 主な画面構成

アプリは主に「時刻表画面」と「設定画面」の2つの画面で構成される。

### 2.1. 時刻表画面 (メイン画面)

- **表示内容:**
    - **設定タイトル:** 現在表示している設定の名称（例：「パパの通勤」）を表示する。
    - **表示切替タブ:** 「行き」「帰り」を切り替えるためのタブ（セグメントコントロール）を配置する。
    - **現在時刻:** 秒単位でリアルタイムに更新される現在時刻（例: `07:30:15`）を表示する。
    - **バス予定一覧:** 選択中のタブ（行き/帰り）に対応するバスの予定をリスト形式で表示する。
    - **接近情報ボタン:** 選択中のタブに対応する「市バス接近情報」をアプリ内ブラウザで表示するためのボタンを配置する。

- **リストの表示項目:**
    - 時刻 (`HH:MM`)
    - 路線名 (例: `鳴子14`)
    - 行き先 (例: `地下鉄鳴子北`)
    - のりば番号 (例: `2`)

### 2.2. 設定画面

- **機能:**
    - 複数の「行き帰りセット」を管理（追加・編集・削除）する。
    - 各セットには以下の情報を登録できる。
        - **設定名:** 任意の名称（例：「パパの通勤」）
        - **行きのURLリスト:** 時刻表を取得するためのURLを複数登録可能。
        - **帰りのURLリスト:** 時刻表を取得するためのURLを複数登録可能。
        - **行きの接近情報URL:** 市バス接近情報ページのURLを1つ登録可能。
        - **帰りの接近情報URL:** 市バス接近情報ページのURLを1つ登録可能。

---

## 3. 機能仕様

### 3.1. 時刻表データ取得

- アプリは設定されたURLからバスの時刻表データを取得する（スクレイピング）。

### 3.2. 曜日・祝日の自動判定

- アプリ起動時および日付変更時に、現在の曜日と祝日を自動で判定する。
- **判定ロジック:**
    1. まず、祝日かどうかを判定する。
    2. 祝日の場合、休日ダイヤ用の時刻表データを取得する。
    3. 祝日でない場合、曜日（平日/土曜/日曜）を判定し、対応するダイヤの時刻表データを取得する。
- **祝日判定API:**
    - `https://holidays-jp.github.io/api/v1/date.json` を利用する。

### 3.3. 接近情報の表示

- 「時刻表画面」上の「接近情報ボタン」をタップすると、設定画面で登録された対応する「接近情報URL」を**アプリ内ブラウザ**で表示する。

### 3.4. 表示の動的更新

- 現在時刻がバスの出発時刻を過ぎた場合、その行は自動的にグレーアウトされ、視覚的に過去の予定であることがわかるようにする。

### 3.5. 設定の永続化

- 「設定画面」で登録したすべての設定（設定名、各種URL）は、アプリ内に永続的に保存される。アプリを再起動しても設定は維持される。

---
## 4. 非機能要件

- **対象プラットフォーム:** iOS
- **配布方法:** Apple Storeへの申請は行わず、プライベートな方法で配布する。
- **データソース:** 名古屋市交通局の公式ウェブサイト。
- **外部依存:** 祝日判定のために `holidays-jp.github.io` のAPIへアクセスする。