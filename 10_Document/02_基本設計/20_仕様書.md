# iOSバス時刻表アプリ 仕様書

- **バージョン:** 0.7
- **作成日:** 2025/08/21
- **更新日:** 2025/08/28

---

## 1. アプリの目的

家族が日常的に利用する複数のバス路線の時刻表情報とリアルタイム接近情報を集約し、一つのアプリで簡単に確認できるようにする。手動での情報確認の手間を省き、乗り遅れを防ぐことを目的とする。

---

## 2. 主な画面構成

アプリは「駅選択画面」、「時刻表画面」、「設定画面」の3つの画面で構成される。

### 2.1. 駅選択画面 (初回起動画面)

- **表示タイミング:** アプリ起動時の初回画面
- **目的:** バス時刻表検索のための出発駅・到着駅を設定する

- **表示内容:**
    - **出発駅入力フィールド:** 乗車駅の名称を入力（例：「新宿駅」）
    - **到着駅入力フィールド:** 降車駅の名称を入力（例：「渋谷駅」）
    - **確定ボタン:** 駅ペアを保存して時刻表画面へ遷移
    - **検索履歴セクション:** 過去に検索した駅ペアの履歴を最大10件表示
        - 各履歴項目には駅ペア（例：「新宿駅 → 渋谷駅」）と検索日時を表示
        - タップで入力フィールドに自動入力される
        - 履歴クリア機能付き

### 2.2. 時刻表画面 (メイン画面)

- **表示内容:**
    - **設定タイトル:** 現在表示している設定の名称（例：「パパの通勤」）を表示する。
    - **表示切替タブ:** 「行き」「帰り」を切り替えるためのタブ（セグメントコントロール）を配置する。
    - **現在時刻:** 秒単位でリアルタイムに更新される現在時刻（例: `07:30:15`）を表示する。
    - **バス予定一覧:** 選択中のタブ（行き/帰り）に対応するバスの予定をリスト形式で表示する。
    - **接近情報ボタン:** 選択中のタブに対応する「市バス接近情報」をアプリ内ブラウザで表示するためのボタンを配置する。

- **リストの表示項目:**
    - 時刻 (`HH:MM`)
    - 路線名 (例: `鳴子14`)
    - 行き先 (例: `地下鉄鳴子北`)
    - のりば番号 (例: `2`)

### 2.3. 設定画面

- **機能:**
    - 複数の「行き帰りセット」を管理（追加・編集・削除）する。
    - 各セットには以下の情報を登録できる。
        - **設定名:** 任意の名称（例：「パパの通勤」）
        - **行きのルートリスト:** GTFS-JPルート識別子を複数登録可能。
        - **帰りのルートリスト:** GTFS-JPルート識別子を複数登録可能。
        - **行きの接近情報URL:** 市バス接近情報ページのURLを1つ登録可能。
        - **帰りの接近情報URL:** 市バス接近情報ページのURLを1つ登録可能。

---

## 3. 機能仕様

### 3.1. 時刻表データ取得

- アプリはGTFS-JP仕様書第3版のデータから時刻表データを取得する。

### 3.2. 曜日・祝日の自動判定

- アプリ起動時および日付変更時に、現在の曜日と祝日を自動で判定する。
- **判定ロジック:**
    1. まず、祝日かどうかを判定する。
    2. 祝日の場合、休日ダイヤ用の時刻表データを取得する。
    3. 祝日でない場合、曜日（平日/土曜/日曜）を判定し、対応するダイヤの時刻表データを取得する。

### 3.3. 接近情報の表示

- 「時刻表画面」上の「接近情報ボタン」をタップすると、設定画面で登録された対応する「接近情報URL」を**アプリ内ブラウザ**で表示する。

### 3.4. 表示の動的更新

- 現在時刻がバスの出発時刻を過ぎた場合、その行は自動的にグレーアウトされ、視覚的に過去の予定であることがわかるようにする。

### 3.5. 設定の永続化

- 「設定画面」で登録したすべての設定（設定名、各種URL）は、アプリ内に永続的に保存される。アプリを再起動しても設定は維持される。
- 「駅選択画面」で入力した駅ペアと検索履歴もUserDefaultsに永続的に保存される。

### 3.6. 駅選択機能

- **駅ペア保存:** 出発駅・到着駅の組み合わせを保存し、次回起動時に自動復元する。
- **検索履歴管理:** 
    - 確定された駅ペアを履歴として保存（最大10件）
    - 同じ駅ペアは重複せず、最新のものが履歴の先頭に配置される
    - 履歴項目をタップして入力フィールドに自動入力可能
    - 履歴全体のクリア機能を提供

---
## 4. 非機能要件

- **対象プラットフォーム:** iOS
- **配布方法:** Apple Storeへの申請は行わず、プライベートな方法で配布する。
- **データソース:** GTFS-JP仕様書第3版データ。
