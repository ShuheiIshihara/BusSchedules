# バス停選択画面 - 画面設計書

## 1. 画面概要

**画面名**: バス停選択画面 (StationSelectionView)  
**目的**: ユーザーが出発バス停と到着バス停を入力し、バス時刻表検索のためのバス停ペアを設定する  
**表示タイミング**: アプリ起動時の初回画面

---

## 2. ワイヤーフレーム

```
┌─────────────────────────────────────────┐
│              バス停の選択                │
├─────────────────────────────────────────┤
│                                         │
│  出発バス停                              │
│ ┌─────────────────────────────────────┐ │
│ │  池袋駅                              │ │
│ └─────────────────────────────────────┘ │
│   ↑↓                                    │
│  到着バス停                              │
│ ┌─────────────────────────────────────┐ │
│ │  上野駅                              │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │                検索                  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│  検索履歴                        クリア  │
│ ┌─────────────────────────────────────┐ │
│ │  新宿駅 → 渋谷駅           8/28 14:30 >│ │
│ ├─────────────────────────────────────┤ │
│ │  池袋駅 → 上野駅           8/27 09:15 >│ │
│ ├─────────────────────────────────────┤ │
│ │  東京駅 → 品川駅           8/26 18:45 >│ │
│ └─────────────────────────────────────┘ │
│                                         │
│                                         │
└─────────────────────────────────────────┘
```

---

## 3. 画面構成要素

### 3.1 ヘッダー
- **ナビゲーションタイトル**: 「バス停の選択」
- **戻るボタン**: なし（初回画面のため）

### 3.2 入力セクション

#### 3.2.1 出発バス停入力
- **ラベル**: 「出発バス停」
- **入力フィールド**: 
  - プレースホルダー: 「野並」
  - スタイル: 角丸ボーダー、純白背景
  - 必須入力項目

#### 3.2.2 到着バス停入力  
- **ラベル**: 「到着バス停」
- **入力フィールド**:
  - プレースホルダー: 「緑車庫」
  - スタイル: 角丸ボーダー、純白背景
  - 必須入力項目

### 3.3 アクションセクション

#### 3.3.1 確定ボタン
- **テキスト**: 「確定」
- **スタイル**: グラデーションボタン（ピンク→紫のグラデーション、白文字）
- **幅**: 画面幅いっぱい
- **角丸**: 12px
- **状態**:
  - 有効: 両方のバス停名が入力済み
  - 無効: どちらかのバス停名が空の場合（透明度60%）

### 3.4 履歴セクション

#### 3.4.1 セクションヘッダー
- **左側**: 「検索履歴」ラベル
- **右側**: 「クリア」ボタン（小さいフォント、システムピンク色）

#### 3.4.2 履歴リスト
- **表示条件**: 履歴データが存在する場合のみ表示
- **最大表示件数**: 10件
- **背景**: 純白背景、角丸12px、軽いドロップシャドウ
- **各履歴項目**:
  - **左側**: 
    - バス停名ペア（例: 「野並 → 緑車庫」）
    - 検索日時（例: 「8/28 14:30」、小さいフォント、グレー色）
  - **右側**: 右矢印アイコン（chevron.right）
  - **区切り線**: 項目間に薄いグレーの線
  - **操作**: タップで入力フィールドに自動入力

---

## 4. インタラクション

### 4.1 ユーザー操作フロー
1. **起動時**: 前回保存されたバス停名を自動表示（存在する場合）
2. **入力**: 出発バス停・到着バス停を手動入力
3. **履歴選択**: 履歴項目をタップして自動入力（オプション）
4. **確定**: ボタンタップでメイン画面へ遷移

### 4.2 状態管理
- **保存タイミング**: 確定ボタン押下時
- **履歴更新**: 確定時に履歴リストの先頭に追加
- **重複処理**: 同じバス停ペアの場合、既存項目を削除して最新を先頭に追加

### 4.3 データ永続化
- **保存場所**: UserDefaults
- **保存データ**:
  - 現在のバス停ペア: 単一オブジェクト
  - 検索履歴: 配列（最大10件）

---

## 5. レスポンシブ設計

### 5.1 画面サイズ対応
- **レイアウト**: VStackベースで縦方向に配置
- **入力フィールド**: 画面幅に応じて自動調整
- **ボタン**: 画面幅いっぱいに拡張

### 5.2 フォント・カラー（ライトモード固定仕様）
- **アプリ設定**: `.preferredColorScheme(.light)` でライトモード強制
- **背景色**: 薄いピンク色（Color.pink.opacity(0.1)）
- **ヘッダー**: システム標準フォント
- **入力フィールド**: 純白背景（Color.white）、角丸8px
- **履歴日時**: キャプションフォント、セカンダリーカラー
- **確定ボタン**: 白文字、カスタムピンク→紫グラデーション背景
  - ピンク: Color(red: 1.0, green: 0.4, blue: 0.7)
  - 紫: Color(red: 0.6, green: 0.2, blue: 0.8)
- **履歴項目**: 純白背景コンテナ、角丸12px、軽いドロップシャドウ
- **「クリア」ボタン**: システムピンク色（Color.pink）

---

## 6. アクセシビリティ

### 6.1 VoiceOver対応
- 各入力フィールドにアクセシビリティラベル設定済み
- ボタンの状態（有効/無効）を音声で通知

### 6.2 キーボードナビゲーション
- Tab順序: 出発駅 → 到着駅 → 確定ボタン
- Return キーで次のフィールドへフォーカス移動

---

## 7. 技術実装詳細

### 7.1 使用コンポーネント
- **NavigationView**: 画面全体のナビゲーション構造
- **ZStack**: 背景色とコンテンツの重ね合わせ
- **VStack**: 縦方向の要素配置
- **TextField**: バス停名入力フィールド
- **Button**: 確定ボタンおよび履歴選択
- **LinearGradient**: 確定ボタンのグラデーション背景
- **Image**: 履歴項目の右矢印アイコン

### 7.2 データモデル
```swift
struct StationPair: Codable, Equatable, Identifiable {
    let id = UUID()
    let departureStation: String
    let arrivalStation: String
    let createdAt: Date
}
```

### 7.3 ViewModel機能
- バス停ペアの保存・読み込み
- 検索履歴の管理（追加・削除・重複処理）
- UserDefaultsによるデータ永続化