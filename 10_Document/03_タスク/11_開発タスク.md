# iOSバス時刻表アプリ 開発タスクリスト (WBS)
**更新日: 2025-08-31**  
**データソース: Supabase PostgreSQL Database (匿名アクセス)**

## Phase 1: プロジェクト基盤の整備
- [x] **1-1. Xcodeプロジェクトの新規作成**
    - 基本的なアプリの設定（アプリ名、IDなど）を行う。
- [x] **1-2. 駅選択画面の基本実装**
    - StationSelectionView、StationSelectionViewModel、StationPairモデルを実装。
- [ ] **1-3. Supabase Swift SDK統合**
    - Package.swiftまたはXcode Package ManagerでSupabase Swift SDKを追加。
    - 基本的な接続設定とSupabaseServiceクラスの作成。
- [ ] **1-4. 匿名認証の実装**
    - Supabaseクライアントで匿名ユーザー認証を設定。
    - データベース接続テストの実装。

---

## Phase 2: データモデルとサービス層の実装
- [ ] **2-1. GTFS準拠データモデルの作成**
    - BusScheduleモデル（departure_time, route_name, destination, platform）
    - RouteSettingモデル（id, name, route_ids, proximity_urls）
    - Holidayモデル（date, name）の定義
- [ ] **2-2. SupabaseServiceの実装**
    - データベースからの時刻表データ取得機能
    - 運行日判定（平日/土日祝日）に基づくサービス選択
    - エラーハンドリングとリトライロジック
- [ ] **2-3. HolidayServiceの実装**
    - Supabaseから祝日データを取得
    - 現在日付の祝日判定機能
    - キャッシュ機能の実装
- [ ] **2-4. PersistenceServiceの更新**
    - Core DataからUserDefaults/SwiftDataへの移行検討
    - 設定データの保存・読み込み機能

---

## Phase 3: メイン機能の実装
- [ ] **3-1. メイン時刻表画面の実装**
    - 現在時刻のリアルタイム表示（HH:MM:SS形式、1秒更新）
    - 「行き」「帰り」タブ切替機能（セグメントコントロール）
    - バス時刻表リストの表示
    - 過去時刻の自動グレーアウト機能
- [ ] **3-2. ScheduleViewModelの実装**
    - SupabaseServiceとの連携
    - リアルタイムデータ更新ロジック
    - タブ切替時のデータ更新処理
- [ ] **3-3. 動的時刻表示の実装**
    - Timerを使用した1秒間隔の時刻更新
    - 過去時刻の視覚的区別（グレーアウト）
    - 日付変更時の自動データ更新

---

## Phase 4: 設定画面と周辺機能
- [ ] **4-1. 設定画面の実装**
    - 路線設定の一覧表示
    - 新規設定追加・編集フォーム
    - 設定削除機能
    - 近接情報URL設定機能
- [ ] **4-2. SettingsViewModelの実装**
    - 設定データのCRUD操作
    - PersistenceServiceとの連携
    - バリデーション機能
- [ ] **4-3. WebViewコンポーネントの実装**
    - バス接近情報表示用のアプリ内ブラウザ
    - URL読み込み機能とエラーハンドリング
    - ナビゲーションコントロール

---

## Phase 5: 統合とテスト
- [ ] **5-1. データとUIの連携**
    - アプリ起動時の設定読み込み
    - 設定変更の即座な反映機能
    - データ更新時のUI自動リフレッシュ
- [ ] **5-2. 全体的な動作検証**
    - 各画面間の遷移テスト
    - データ取得・表示の整合性確認
    - エラー状態の適切な処理確認
- [ ] **5-3. ユニットテストの実装**
    - SupabaseService、HolidayServiceのテスト
    - ViewModelのロジックテスト
    - Mock objects の作成（BusSchedulesTests/Mocks/）
- [ ] **5-4. UIテストの実装**
    - 画面遷移フローのテスト
    - ユーザー操作シナリオの自動テスト
- [ ] **5-5. 最終調整とビルド**
    - パフォーマンス最適化
    - 実機での動作確認
    - リリース用ビルドの作成

---

## 技術仕様メモ
- **データベース**: Supabase PostgreSQL
- **認証**: 匿名アクセス（Row Level Security適用）
- **アーキテクチャ**: MVVM + Service Layer
- **UI**: SwiftUI
- **データ永続化**: UserDefaults/SwiftData
- **依存関係**: Supabase Swift SDK