# 検索ボタン押下時の処理実装計画

## 現状分析

### 既存の実装状況
1. **StationSelectionView**: 駅選択画面は実装済み（乗車駅・降車駅入力、検索ボタン）
2. **StationPair**: 駅ペアモデルは実装済み
3. **SupabaseService**: データベース接続とRPC関数呼び出し基盤は実装済み
4. **ContentView**: まだデフォルトテンプレートのまま（メイン画面未実装）

### 画面デザイン要求事項
- 駅名表示（例：名古屋駅）
- 日付表示（例：2025年8月23日(土)）
- 平日/土日祝タブ切り替え
- 時刻表リスト（発車時刻、路線名、行先、のりば、タップで詳細表示）
- 現在時刻表示（18:39）
- 行き/帰りタブ切り替え

## 実装計画

### 1. メイン画面（時刻表表示画面）の実装
- **BusScheduleView**: 画面デザイン準拠のメイン時刻表画面を新規作成
  - 駅名・日付表示ヘッダー
  - 平日/土日祝タブUI
  - 現在時刻リアルタイム表示
  - 時刻表リストビュー
  - 行き/帰りタブUI
- **BusScheduleViewModel**: 時刻表データ管理・状態管理用ViewModel
  - StationPair受け取り
  - SupabaseServiceからのデータ取得
  - タブ切り替え状態管理
  - 現在時刻管理
- **BusScheduleModel**: 時刻表データ構造の定義
  - BusScheduleDataの拡張または新規定義

### 2. ナビゲーション実装
- **ContentView**: 駅選択画面からメイン画面への遷移処理
  - NavigationViewの適切な設定
  - StationSelectionView → BusScheduleView遷移
- **StationSelectionView**: onStationsPaired コールバック処理
  - 検索ボタン押下時のナビゲーション処理

### 3. データ取得処理の完成
- **SupabaseService.getBusSchedules**: RPC関数レスポンス解析とBusScheduleData配列への変換
  - JSON解析処理の実装
  - エラーハンドリング強化
- **日付・運行日判定**: 平日/土日祝の自動判定機能
  - 現在日付での運行パターン判定
  - カレンダー情報の活用
- **リアルタイム時刻表示**: 現在時刻の表示と過去時刻のグレーアウト
  - Timer実装
  - 時刻比較処理

### 4. UI機能実装
- **タブ切り替え**: 平日/土日祝、行き/帰りのタブ機能
  - SegmentedPickerまたはカスタムタブ実装
  - 選択状態の管理
- **詳細表示**: 「タップして詳細を表示」機能
  - 展開可能リストアイテム
  - 詳細情報の表示制御
- **のりばボタン**: 近接情報WebView表示機能
  - WebViewコンポーネント連携
  - モーダル表示処理

### 5. エラーハンドリング・UX改善
- **データ取得エラー時の表示**
  - エラーメッセージ表示
  - リトライ機能
- **ローディング状態の表示**
  - プログレスインジケーター
  - スケルトン画面
- **空データ時の案内メッセージ**
  - 「時刻表が見つかりません」等の表示

## 実装順序

1. **Phase 1**: BusScheduleViewの基本画面実装
2. **Phase 2**: SupabaseService.getBusSchedulesの完成
3. **Phase 3**: ContentViewナビゲーション実装
4. **Phase 4**: リアルタイム機能（時刻表示、過去時刻グレーアウト）
5. **Phase 5**: タブ機能とUI詳細実装
6. **Phase 6**: エラーハンドリングとUX改善

## 期待される結果

この実装により、以下の一連の流れが完成します：
1. 駅選択画面で乗車駅・降車駅を入力
2. 検索ボタンを押下
3. メイン画面に遷移し、時刻表が表示される
4. リアルタイムで現在時刻が更新され、過去の時刻はグレーアウト
5. 平日/土日祝、行き/帰りのタブで表示内容を切り替え可能
6. 各時刻表項目をタップして詳細表示
7. のりばボタンで近接情報を確認可能